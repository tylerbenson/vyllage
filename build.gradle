def vJavaLang = '1.8'
def gradleDir = "${rootProject.rootDir}/gradle"
ext.javascriptProjects = [ project(':assets') ]
ext.javaProjects = [ project(':login'), project(':editor'),  project(':site'), project(':connections') ]
ext.bootProjects = [ project(':login'), project(':editor'),  project(':site'), project(':connections') ]

wrapper.gradleVersion = '2.1'

buildscript {
    ext {
        springBootVersion = '1.1.8.RELEASE'
    }
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
    }
}

repositories {
    mavenCentral()
}

configure(subprojects) {
    apply plugin: 'eclipse'
}

configure(rootProject) {
    apply from: 'gradle/gitMetadata.gradle'
}

configure(javaProjects) {
    apply plugin: 'java'

    targetCompatibility = vJavaLang
    sourceCompatibility = vJavaLang

    repositories {
        mavenCentral()
    }

    dependencies {
        compile 'org.slf4j:slf4j-api'
        compile 'org.projectlombok:lombok:1.14.8'
        testCompile 'junit:junit'
        testCompile 'org.hamcrest:hamcrest-library'
        testCompile 'org.mockito:mockito-core'
    }

    configurations {
        // replaced with jcl-over-slf4j
        all*.exclude group: 'commons-logging', module: 'commons-logging'
        // replaced with log4j-over-slf4j
        all*.exclude group: 'log4j', module: 'log4j'
    }

    // Ensure that all Gradle-compiled classes are available to Eclipse's classpath.
    eclipseClasspath.dependsOn testClasses

    eclipse {
        classpath {
             containers.remove('org.eclipse.jdt.launching.JRE_CONTAINER')
             containers 'org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.8'
        }
    }

    test {
        // Set PROJECT_HOME env variable to the root. This allows to register an additional
        // resource handler location and serve static resources directly from the template module during dev.
        // See ClientResourcesConfig
        jvmArgs "-DPROJECT_HOME=${rootProject.rootDir}"
    }
}

configure(bootProjects) {
    apply plugin: 'spring-boot'
    apply from: "$gradleDir/integTest.gradle"
    apply from: "$gradleDir/deploy.gradle"
    //apply from: "$gradleDir/writeGitPropertiesFile.gradle"

    springBoot.backupSource = false
    //bootRun.dependsOn writeGitPropertiesFile

    applicationDefaultJvmArgs = [
            // Set PROJECT_HOME env variable to the root. This allows to register an additional
            // resource handler location and serve static resources directly from the template module during dev.
            // See ClientResourcesConfig
            "-DPROJECT_HOME=${rootProject.rootDir}"
    ]
}

task stage(dependsOn: [':site:build'])
